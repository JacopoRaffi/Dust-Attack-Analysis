\chapter{Il Dust Attack}
Tra i molteplici attacchi all'anonimato di Bitcoin, un attacco interessante è il Dust Attack. Il Dust Attack è una nota tecnica di de-anonimizzazione il cui obiettivo è capire che certi address appartengano al medesimo wallet.

Gli obiettivi principali di questa tesi sono quindi:
\begin{itemize}
\item Definire il Dust Attack, spiegandone le conseguenze e le possibili contromisure;
    \item Presentare delle statistiche generali su come venga speso il dust, in particolare mostrare se e quanto possa essere efficace un Dust Attack mostrando gli effetti del dust sulla de-anonimizzazione degli address e dei relativi wallet;
    \item Descrivere alcuni pattern interessanti che sono stati individuati e che potrebbero essere messi in relazione con il  Dust Attack.
\end{itemize}

Siccome il Dust Attack sfrutta l'utilizzo degli importi dust, è importante quindi spiegare cosa sia il dust e in generale quali possano essere i suoi possibili impieghi.
\section{Definizione del dust}
Nelle transazioni di Bitcoin generalmente l'importo totale di input non viene speso completamente in output ma parte di esso viene inviato ai miners come fee. Formalmente la fee di una transazione, raccolta dai miners come ricompensa per includere la transazione in un blocco, è definita come:
\begin{center}
    $fee = \sum_{i=0}^{\#inputs} importo(input_i) - \sum_{j=0}^{\#outputs} importo(output_i)$
\end{center}
La fee quindi non è altro che la differenza tra l'importo totale di input e l'importo totale di output, assume valori $\ge 0$. In generale la fee viene stabilita autonomamente dal creatore della transazione per incentivare i miners a validare la transazione stessa. 

Tuttavia, per convenzione, esiste una fee minima, denominata \textit{minimum relay fee}, che una transazione deve pagare affinchè un nodo inoltri quella transazione agli altri nodi della rete. Questo valore non è prefissato e quindi può variare nel tempo. 

Nel client ufficiale, Bitcoin Core \cite{btccore}, esiste una convenzione, definita ``dust limit", introdotto per le transazioni standard, cioè quelle transazioni che i nodi sono suggeriti accettare e reinviare.

Lo scopo è quello di considerare non-standard le transazioni che generano degli output dust proprio perchè costerebbe di più per il destinatario spendere l'importo dust rispetto al valore dell'output creato. Infatti un importo dust non può essere speso singolarmente, poichè $<$ della \textit{minimum relay fee}, perciò deve essere aggregato ad altri input.

Il limite attuale è di 546 satoshi \cite{BtcDev}. Quindi tutti gli importi $<$ 546 satoshi sono definiti \textbf{dust}.
\section{Possibili utilizzi del dust}
Gli usi del dust possono essere molteplici. In generale può essere utilizzato per effettuare degli stress test della rete Bitcoin, proprio perchè permette di generare tante transazioni con molti output ad un basso costo. In questo caso il costo è determinato principalmente dalla fee della transazione e non tanto dagli output. Se consideriamo che il valore di 1 satoshi, unità minima di Bitcoin, vale meno di un centesimo, è possibile generare una transazione con 1000 output dust, 1 satoshi ciascusno, al costo di qualche centesimo.

Esistono però alcuni casi interessanti di uso del dust, tra questi consideriamo il suo utilizzo nel servizio di gambling Satoshi Dice, la scrittura di dati arbitrari tramite lo script OP\_RETURN e il Dust Attack.
\subsection{Satoshi Dice}
Satoshi Dice è un noto ``gioco di scommesse basato su blockchain" nato nell'Aprile 2012 \cite{SD}. A differenza dei tradizionali software di gioco online, le scommesse con Satoshi Dice possono essere inviate senza accedere al sito Web né eseguire alcun software client. Per giocare, viene effettuata una transazione Bitcoin a uno degli address resi pubblici da Satoshi Dice, caratterizzato da probabilità di vincita e quindi di pagamenti diversi. Tutti gli address resi pubblici da Satoshi Dice sono vanity address.

Un vanity address in generale è un address Bitcoin con le stesse funzionalità di qualsiasi altro address ma presenta una stringa personalizzata contenente una parola o un messaggio comprensibili alle persone. Un esempio di vanity address è 1BoatSLRHtKNngkdXEeobR76b53LETtpyT, che contiene la parola Boat, barca tradotto in italiano. 

Tutti gli address di Satoshi Dice presentano il prefisso \textbf{1dice}, ogni address presenta probabilità diverse di vincere la scommessa, generalmente minore è la probabilità maggiore è il compenso che si ottiene da una vincita. Per esempio l'address 1dice1e6pdhLzzWQq7yMidf6j8eAg7pkY offre una probabilità dello 0,0015\% di vincere 64 000 volte la puntata originale.

Per determinare se una scommessa è vincente o perdente, Satoshi Dice genera un numero casuale, il quale viene assegnato al giocatore. Il servizio successivamente utilizza una combinazione dell'hash della transazione della scommessa ed esegue un hash SHA2 a 512 bit prendendo come input l'hash della transazione utilizzando un segreto sconosciuto al giocatore. I primi quattro byte dell'output diventano il numero che determina se il giocatore abbia vinto la scommessa.

Il servizio, dopo aver determinato le scommesse vincenti e quelle perdenti, invia una transazione in risposta con il pagamento al vincitore e restituisce un sinoglo satoshi ai giocatori perdenti per comunicare loro la perdita. Questo significa che Satoshi Dice utilizza il dust, 1 satoshi, per comunicare la perdita di una scommessa.
\subsection{Dust in OP RETURN}
Le transazioni in Bitcoin sono molto più complesse \cite{script} di come descritte nel capitolo precedente \ref{Transazioni}, non contengono solo valori come address e importo ma includono anche del codice, in particolare ogni transazione comprende anche degli script che descrivono quali siano le condizioni che devono essere verificate affinchè il destinatario dei bitcoin possa spenderli. 

Bitcoin utilizza un sistema di script Forth-like, basato su stack e non Turing-completo; questa scelta è intenzionale in quanto impedisce possibili cicli infiniti. 

Gli script \cite{opcode} in Bitcoin sono:
\begin{itemize}
    \item Senza stato: non esiste uno stato prima dell'esecuzione di uno script né viene salvato dopo l'esecuzione.
    \item Deterministici: uno script viene eseguito alla stessa maniera in ogni sistema.
    \item Semplici e compatti: le istruzioni, gli OP\_CODE, sono codificate in un singolo byte. In totale ci sono 75 istruzioni funzionanti e 15 disabilitate.
\end{itemize}
Gli OP\_CODE in Bitcoin comprendono diverse categorie:
\begin{itemize}
    \item aritmetica di base: OP\_ADD, OP\_SUB;
    \item controllo di flusso: OP\_IF, OP\_ELSE;
    \item logica bit a bit: OP\_EQUAL;
    \item gestione stack: OP\_DROP, OP\_SWAP;
    \item hashing: OP\_SHA1, OP\_SHA256;
    \item verifica firma o multifirma: OP\_CHECKMULTISIG.
\end{itemize}

Le transazioni Bitcoin non forniscono un campo dove si possono salvare dati arbitrari \cite{arbdata}. Tuttavia, gli utenti hanno ideato diversi modi creativi per codificare dati arbtrari nelle transazioni, in particolare memorizzando valori arbitrari negli output delle transazioni. Questi metodi però modificavano il protocollo rendendo inspendibili gli output così generati. Il problema è che questi output non erano facilmente distinguibili dagli altri quindi in nodi della rete dovevano salvarli nei loro UTXO.

L'UTXO(Unspent Transaction Output) è l'insieme degli output riscattabili di tutte le transazioni della blockchain. Per essere valida, una transazione deve utilizzare solo elementi dell'UTXO come input.

Poiché questo set, per motivi di efficienza, è solitamente memorizzato nella RAM \cite{utxo} questa pratica influiva negativamente sul consumo di memoria dei nodi \cite{stresstest}.

Per risolvere tale problema nel 2014 è stato reso standard il codice OP\_RETURN \cite{opreturnstandard} . Questo OP\_CODE era presente fin dalla nascita di Bitcoin, però era considerato uno script non-standard proprio perchè la scrittura di dati arbitrari sulla blockchain non è stata considerata fin dall'inizio una buona pratica. Questo codice permette di segnare un output della transazione come non valido, quindi successivamente non potrà essere speso.

Poichè gli output con questo OP\_CODE sono contrassegnati come non spendibili, possono essere rimossi dall'UTXO set. In questo modo OP\_RETURN risolve il problema del consumo di memoria spiegato precedentemente. Il limite iniziale per la memorizzazione dei dati con questo codice era pianficato per essere di 80 byte, ma inizialmente ne furono concessi 40 (versione 0.9.0).  La versione 0.11.0 \cite{v11} ha esteso il limite di dati a 80 byte e la versione 0.12.0 \cite{v12} fino a un massimo di 83 byte. Inoltre una transazione standard non può contenere più di un output contenenti OP\_RETURN.

Siccome per scrivere dati arbitrari sulla blockchain è comunque necessario generare una transazione con almeno un output risulta quindi molto più conveniente generare output con importi dust proprio per ridurre al minimo i costi della transazione.

Come riportato in \cite{OP_RETURN} esistono diversi protocolli che sfruttano OP\_RETURN. Di solito, un protocollo è identificato dai primi byte di metadati allegati all'OP RETURN, ma il numero esatto di byte può variare da protocollo a protocollo. 

Questi protocolli possono essere divisi in categorie tra le quali:
\begin{itemize}
    \item \textbf{Risorse}: protocolli che sfruttano l'immutabilità della blockchain per certificare la proprietà, lo scambio e, infine, il valore dei beni del mondo reale. I metadati nelle transazioni vengono utilizzati per specificare ad es. il valore del bene, il importo del bene trasferito, il nuovo proprietario, ecc;  
    \item \textbf{Atti notarili}: protocolli per la certificazione della proprietà di un documento. Un utente può pubblicare l'hash di un documento in una transazione, e in questo modo può provarne l'esistenza e l'integrità;
    \item \textbf{Arte digitale}: protocolli per la dichiarazione dei diritti di accesso e di copia di arti digitali, come ad es. foto o musica.
\end{itemize}

In generale salvare dati sulla blockchain di Bitcoin non è una buona pratica, infatti anche la documentazione ufficiale di Bitcoin sconsiglia questo utilizzo \footnote{Le note di rilascio di  Bitcoin Core versione 0.9.0 affermano che: “Storing arbitrary data in the blockchain is still a bad idea; it is less costly and far more efficient to store non-currency data elsewhere.”}.
\section{Il Dust Attack}\label{dstatt}
Come analizzato nel capitolo precedente \ref{Anonimato} esistono delle euristiche che possono essere sfruttate per effettuare determinati attacchi in grado di violare l'anonimato di Bitcoin. L'attacco che verrà approfondito in questa tesi viene denominato \textbf{Dust Attack}. 

L'euristica utilizzata da questo tipo di attacco è la regola degli input multipli:
\begin{center}
    ``\textit{In una transazione multi-input tutti gli address appartengono allo stesso utente}"
\end{center}
L'obiettivo del Dust Attack è la de-anonimizzazione del proprietario di un wallet, in particolare l'attaccante vuole scoprire quali address appartengano allo stesso wallet, così da ottenere un'importante informazione che può essere utilizzata per effettuare altri attacchi più elaborati e molto più pericolosi.

Il Dust Attack deriva il proprio nome dall'impiego del dust, infatti il dust, nelle transazioni standard, non è mai speso singolarmente ma viene sempre unito ad altri importi. L'attaccante quindi, come mostrato in figura \ref{fig:Dust_attack}, invia centinaia, o migliaia, di importi dust ad address diversi confidando che vengano spesi successivamente in una nuova transazione insieme ad altri address. Se ciò avviene l'attaccante riesce a collegare questi address e capire che appartengono, con una certa probabilità, allo stesso utente. Gli address a cui viene inviato il dust sono tutti non-nuovi, ovvero address già comparsi in precedenza sulla blockchain. Le transazioni che inviano del dust ad address nuovi  molto probabilmente non rappresentano un Dust Attack, proprio perchè risulterebbe alquanto inusuale de-anonimizzare un address mai visto fino a quel momento; molto probabilmente il proprietario di un address nuovo è lo stesso utente che genera quella determinata transazione poichè è l'unico a conoscenza di quel determinato address.

Il Dust Attack ad un primo sguardo potrebbe sembrare particolarmente costoso, proprio perchè invia tanti importi ad address differenti, ma se analizziamo il valore in euro di un singolo satoshi, si può osservare che il costo è relativo; soprattutto se l'obiettivo finale è il furto dei bitcoin delle vittime. Infatti abbiamo che:
\begin{center}
    1 satoshi = 0.00016 € (in data 16/11/2022) 
\end{center}

Questo significa che 1 singolo satoshi vale meno di 1 centesimo, quindi se un attaccante genera una transazione con 1000 output dust e manda a ciascun address 1 satoshi, in totale spende 16 centesimi, escludendo la fee.   
\begin{figure}[h!]
    \centering
    \includegraphics[scale=0.5, trim = 1cm 5cm 0cm 0cm, clip]{Images/dust_attack.pdf}
    \caption{Schema Dust Attack}
    \label{fig:Dust_attack}
\end{figure}
\FloatBarrier
Una volta effettuato l'attacco possono esserci due possibili esiti: 
    \begin{enumerate}
        \item attacco di successo;
        \item attacco fallito;
    \end{enumerate}
    
Nel primo caso, mostrato in figura \ref{fig:success}, la vittima genera una transazione in cui spende l'importo dust ricevuto insieme ad almeno un altro dei suoi address. 

Questi address quindi sono collegati tra loro ed è possibile capire che appartengano ad uno stesso utente. Se l'attaccante successivamente scopre le informazioni personali, come nome o email, del proprietario di uno di questi address automaticamente scopre che tutti gli altri address hanno lo stesso proprietario; inoltre è possibile tracciare l'attività di un singolo utente e non solo di un address singolo.
\begin{figure}[h!]
    \centering
    \includegraphics[scale=0.5,trim = 1cm 6cm 0cm 3cm, clip]{Images/successo.pdf}
    \caption{Schema di Dust Attack di Successo: l'address del dust viene speso con altri address}
    \label{fig:success}
\end{figure}
\FloatBarrier
Esistono invece due possibili motivi per cui un Dust Attack può fallire. In figura \ref{fig:fallito} vengono schematizzati questi due possibili esiti.

Nel primo schema la vittima spende il dust ricevuto, ma utilizza una transazione i cui input si riferiscono tutti all'address in cui è stato depositato il dust. In questo caso l'attaccante non ricava alcuna informazione utile perchè non riesce nell'intento di far unire address diversi di un utente nella medesima transazione. Nel secondo schema invece la vittima non spende il dust, troncando sul nascere l'attacco. 

Il Dust Attack in generale risulta più efficace soprattutto se il dust è diretto verso gli address che hanno un bilancio complessivo pari a zero proprio perché obbliga la vittima a spendere la cifra ottenuta con altri suoi address diversi.

\begin{figure}[h!]
    \centering
    \includegraphics[scale=0.5, trim = 1cm 6cm 0cm 3cm, clip]{Images/fallito2.pdf}
    (a)
    \includegraphics[scale=0.5, trim = 1cm 7cm 0cm 2cm, clip]{Images/fallito1.pdf}
    (b)
    \caption{Schema di Dust Attack Fallito}
    \label{fig:fallito}
    \subcaption{La vittima spende il dust con un solo address}
    \subcaption{La vittima non spende il dust}
\end{figure}
\FloatBarrier

È importante notare che lo scopo del Dust Attack non è quello di rubare fondi di altri utenti né quello di scoprire informazioni personali, per esempio nome e cognome, della vittima, ma permette di ricavare un'importante informazione, ovvero l'appartenenza di address differenti ad uno stesso utente, che può essere usata in seguito per effettuare attacchi elaborati e più pericolosi.

In generale il Dust Attack non necessariamente è legato a phishing o estorsioni ma potrebbe essere usato dalle autorità per tenere traccia degli utenti ed eventualmente rilevare attività illegali.

Infatti una volta otteuto un cluster di address riesco a tracciare l'attività di un singolo utente e non più di un singolo address. Le autorità potrebbero notare che certi utenti interagiscono con address legati a mercati neri, e quindi indagare ulteriormente per scoprire l'identità di queste persone. Uno dei punti fondamentali è legare informazioni personali, come e-mail, nome ed altro, ad un address Bitcoin. In molti casi sono gli utenti stessi che pubblicano sui forum i loro address, in altre situazioni invece è possibile sfruttare gli exchange come Coinbase.

Gli exchange sono servizi che permettono lo scambio tra criptovalute e valute tradizionali basandosi sul valore di mercato della criptovaluta. In exchange come Coinbase è necessario creare un account fornendo informazioni personali come nome, cognome, email ed altro e, una volta registrati, viene creato un wallet associato a quel particolare account. Poichè gli exchange sono esposti ad attacchi hacker molti utenti trasferiscono i loro bitcoin su address appartenenti a software wallet, per esempio Wasabi Wallet.

Una volta che un utente effettua un deposito dal wallet, vittima di Dust Attack, ad un account exchange ecco che l'attaccante collega gli address al proprietario. Una volta ottenuta l'identità del proprietario l'attaccante può eseguire elaborati attacchi di phishing oppure può estorcere denaro minacciandolo di rivelare a tutti l'informazione ottenuta. 

Il Dust Attack però non risulta particolarmente difficile da contrastare, nel paragrafo successivo verranno mostrati due metodi per difendersi da questo tipo di attacco.
\subsection{Contromisure al Dust Attack}
Due metodi che un utente che ha ricevuto un importo dust può utilizzare per contrastare il Dust Attack sono:
    \begin{enumerate}
        \item non spendere l'importo dust ricevuto; 
        \item utlizzare servizi di ``dust collecting". 
    \end{enumerate}
    
La prima soluzione, semplice ed efficace, permette di troncare l'attacco sul nascere. Infatti se il dust non viene speso l'attaccante non potrà mai collegare address diversi dello stesso utente. 

Diversi software wallet implementano questo metodo; per esempio Samurai Wallet \footnote{fonte:\url{https://twitter.com/samouraiwallet/status/1055345822076936192?lang=en}}, nel 2018, consigliò ai suoi utenti, possibili vittime di Dust Attack,  di contrassegnare come "do not spend" l'output dust ricevuto.

La seconda soluzione riguarda i servizi di ``dust collecting", per esempio Dust-B-Gone \cite{Dbg}.
Dust-B-Gone, ideato da Peter Todd già nel 2012, era un servizio che permetteva di disfarsi del dust, non lasciando il dust ricevuto come UTXO, ma trasformandolo in fee per i miner.

Il programma generava un'unica transazione alla quale potevano partecipare più utenti, ogni utente inseriva tra gli input della transazione l'importo dust ricevuto così da potersene liberare. Allo stesso tempo questo servizio proteggeva gli utenti da una possibile de-anonimizzazione, poichè address diversi di una transazione potevano appartenere ad utenti diversi. Un attaccante quindi non avrebbe mai potuto collegare questi address, o comunque ne avrebbe ricavato una falsa informazione.
Purtroppo questo servizio è stato chiuso nel 2016 per vari motivi tra cui il suo poco utilizzo \footnote{fonte: \url{https://twitter.com/SamouraiWallet/status/1293659938422652935}} . 